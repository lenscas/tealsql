

<!DOCTYPE html>
<html>

<head id="head">
    <link id="bulma-theme" rel="stylesheet" href="https://unpkg.com/bulmaswatch/default/bulmaswatch.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">
    <link id="codeHighlight" rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/styles/a11y-light.min.css"
        integrity="sha512-WDk6RzwygsN9KecRHAfm9HTN87LQjqdygDmkHSJxVkVI7ErCZ8ZWxP6T8RvBujY1n2/E4Ac+bn2ChXnp5rnnHA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/styles/a11y-dark.min.css" -->
    <!-- integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg==" -->
    <!-- crossorigin="anonymous" referrerpolicy="no-referrer" /> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/highlight.min.js"
        integrity="sha512-IaaKO80nPNs5j+VLxd42eK/7sYuXQmr+fyywCNA0e+C6gtQnuCXNtORe9xR4LqGPz5U9VpH+ff41wKs/ZmC3iA=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <title>Connection</title>
    <style>
        html,
        body,
        #app {
            height: 100%;
        }

        #app {
            min-height: 100%;
        }

        .footer {
            margin-top: -12px;
        }
        .hideable-state:checked+.hideable-content {
            display: block !important;
        }

        .sticky-sidebar {
            height: calc(100vh - 3.25rem);
            position: sticky;
            top: 0;
            overflow: auto;
        }
        .max-width {
            max-width:100%;
        }
        .hidden-themes-selector {
            display:none;
        }
    </style>
</head>

<body>
    <div id="app">
        <nav class="navbar has-shadow">
            <div class="navbar-brand">
                <div class="navbar-item is-hidden-desktop">
                    <label for="menu-toggle" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
                        <span aria-hidden="true"></span>
                        <span aria-hidden="true"></span>
                        <span aria-hidden="true"></span>
                    </label>
                    
                </div>
            </div>
            <div class="navbar-menu" id="navbar-id">
                <div class="navbar-start">
                    <div class="navbar-item has-dropdown is-hoverable">
                        <a class="navbar-link hidden-themes-selector">
                            Themes
                        </a>
                        <div class="navbar-dropdown is-boxed">
                            <div class="columns">
                                <div class="collumn theme-select-column1"></div>
                                <div class="collumn theme-select-column2"></div>
                            </div>
                        </div>
                    </div>
                    <div class="navbar-item has-dropdown is-hoverable">
                        <a class="navbar-link">
                            Definition files
                        </a>
                        <div class="navbar-dropdown is-boxed">
                        
        <a class="navbar-item" href="definitions/tealsql.d.tl">teal</a>

                        </div>
                    </div>
                </div>
            </div>
        </nav>
        <section class="main-content columns is-fullheight">
            <input type="checkbox" id="menu-toggle" class="is-hidden hideable-state"/>
            <aside id="sidebar" class="column is-2 is-narrow-mobile is-fullheight section is-hidden-touch sticky-sidebar hideable-content">
                <div class="is-hidden-desktop">
                    <div class="dropdown is-hoverable">
                        <div class="dropdown-trigger">
                            <label for="theme-toggle" class="button hidden-themes-selector" aria-haspopup="true" aria-controls="dropdown-menu4">
                                <span>Themes</span>
                                <span class="icon is-small">
                                    <i class="fa fa-angle-down" aria-hidden="true"></i>
                                </span>
                            </label>
                        </div>
                        <input type="checkbox" id="theme-toggle" class="is-hidden hideable-state"/>
                        <div class="dropdown-menu hideable-content" id="dropdown-menu4" role="menu">
                            <div class="dropdown-content">
                                <div class="columns">
                                    <div class="collumn theme-select-column1"></div>
                                    <div class="collumn theme-select-column2"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="dropdown is-hoverable">
                        <div class="dropdown-trigger">
                            <label for="definition-files-toggle" class="button" aria-haspopup="true" aria-controls="dropdown-menu5">
                                <span>Def files</span>
                                <span class="icon is-small">
                                    <i class="fa fa-angle-down" aria-hidden="true"></i>
                                </span>
                            </label>
                        </div>
                        <input type="checkbox" id="definition-files-toggle" class="is-hidden hideable-state"/>
                        <div class="dropdown-menu hideable-content" id="dropdown-menu5" role="menu">
                            <div class="dropdown-content">
                                
        <a class="navbar-item" href="definitions/tealsql.d.tl">teal</a>

                            </div>
                        </div>
                    </div>
                </div>
                <p class="menu-label is-hidden-touch">Navigation</p>
                <ul class="menu-list">
                    
                        <li>
                            <a href="/tealsql/index.html" class="{is_active}">
                                <span class="icon"><i class="fa fa-file"></i></span>
                                tealsql                            </a>
                            <ul>
                                
                                    <li>
                                        <a href="/tealsql/index.html#connect_pool">
                                            <span class="icon is-small"><i class="fa fa-link"></i></span>
                                            connect_pool                                        </a>
                                    </li>
                                
                                    <li>
                                        <a href="/tealsql/index.html#gen_json">
                                            <span class="icon is-small"><i class="fa fa-link"></i></span>
                                            gen_json                                        </a>
                                    </li>
                                
                                    <li>
                                        <a href="/tealsql/index.html#connect">
                                            <span class="icon is-small"><i class="fa fa-link"></i></span>
                                            connect                                        </a>
                                    </li>
                                
                                    <li>
                                        <a href="/tealsql/index.html#nul">
                                            <span class="icon is-small"><i class="fa fa-link"></i></span>
                                            nul                                        </a>
                                    </li>
                                
                                    <li>
                                        <a href="/tealsql/index.html#interval">
                                            <span class="icon is-small"><i class="fa fa-link"></i></span>
                                            interval                                        </a>
                                    </li>
                                
                                    <li>
                                        <a href="/tealsql/index.html#help">
                                            <span class="icon is-small"><i class="fa fa-link"></i></span>
                                            help                                        </a>
                                    </li>
                                
                                    <li>
                                        <a href="/tealsql/index.html#__index">
                                            <span class="icon is-small"><i class="fa fa-link"></i></span>
                                            __index                                        </a>
                                    </li>
                                
                            </ul>
                        </li>
                    
                        <li>
                            <a href="/tealsql/Pool.html" class="{is_active}">
                                <span class="icon"><i class="fa fa-file"></i></span>
                                Pool                            </a>
                            <ul>
                                
                                    <li>
                                        <a href="/tealsql/Pool.html#help">
                                            <span class="icon is-small"><i class="fa fa-link"></i></span>
                                            help                                        </a>
                                    </li>
                                
                                    <li>
                                        <a href="/tealsql/Pool.html#get_connection">
                                            <span class="icon is-small"><i class="fa fa-link"></i></span>
                                            get_connection                                        </a>
                                    </li>
                                
                            </ul>
                        </li>
                    
                        <li>
                            <a href="/tealsql/Connection.html" class="{is_active}">
                                <span class="icon"><i class="fa fa-file"></i></span>
                                Connection                            </a>
                            <ul>
                                
                                    <li>
                                        <a href="/tealsql/Connection.html#help">
                                            <span class="icon is-small"><i class="fa fa-link"></i></span>
                                            help                                        </a>
                                    </li>
                                
                                    <li>
                                        <a href="/tealsql/Connection.html#fetch_optional">
                                            <span class="icon is-small"><i class="fa fa-link"></i></span>
                                            fetch_optional                                        </a>
                                    </li>
                                
                                    <li>
                                        <a href="/tealsql/Connection.html#fetch_all">
                                            <span class="icon is-small"><i class="fa fa-link"></i></span>
                                            fetch_all                                        </a>
                                    </li>
                                
                                    <li>
                                        <a href="/tealsql/Connection.html#fetch_all_async">
                                            <span class="icon is-small"><i class="fa fa-link"></i></span>
                                            fetch_all_async                                        </a>
                                    </li>
                                
                                    <li>
                                        <a href="/tealsql/Connection.html#execute">
                                            <span class="icon is-small"><i class="fa fa-link"></i></span>
                                            execute                                        </a>
                                    </li>
                                
                                    <li>
                                        <a href="/tealsql/Connection.html#fetch_one">
                                            <span class="icon is-small"><i class="fa fa-link"></i></span>
                                            fetch_one                                        </a>
                                    </li>
                                
                                    <li>
                                        <a href="/tealsql/Connection.html#insert">
                                            <span class="icon is-small"><i class="fa fa-link"></i></span>
                                            insert                                        </a>
                                    </li>
                                
                                    <li>
                                        <a href="/tealsql/Connection.html#update">
                                            <span class="icon is-small"><i class="fa fa-link"></i></span>
                                            update                                        </a>
                                    </li>
                                
                                    <li>
                                        <a href="/tealsql/Connection.html#delete">
                                            <span class="icon is-small"><i class="fa fa-link"></i></span>
                                            delete                                        </a>
                                    </li>
                                
                                    <li>
                                        <a href="/tealsql/Connection.html#begin">
                                            <span class="icon is-small"><i class="fa fa-link"></i></span>
                                            begin                                        </a>
                                    </li>
                                
                            </ul>
                        </li>
                    
                        <li>
                            <a href="/tealsql/Stream.html" class="{is_active}">
                                <span class="icon"><i class="fa fa-file"></i></span>
                                Stream                            </a>
                            <ul>
                                
                                    <li>
                                        <a href="/tealsql/Stream.html#iter">
                                            <span class="icon is-small"><i class="fa fa-link"></i></span>
                                            iter                                        </a>
                                    </li>
                                
                                    <li>
                                        <a href="/tealsql/Stream.html#help">
                                            <span class="icon is-small"><i class="fa fa-link"></i></span>
                                            help                                        </a>
                                    </li>
                                
                                    <li>
                                        <a href="/tealsql/Stream.html#try_next">
                                            <span class="icon is-small"><i class="fa fa-link"></i></span>
                                            try_next                                        </a>
                                    </li>
                                
                                    <li>
                                        <a href="/tealsql/Stream.html#next">
                                            <span class="icon is-small"><i class="fa fa-link"></i></span>
                                            next                                        </a>
                                    </li>
                                
                                    <li>
                                        <a href="/tealsql/Stream.html#loop_all">
                                            <span class="icon is-small"><i class="fa fa-link"></i></span>
                                            loop_all                                        </a>
                                    </li>
                                
                            </ul>
                        </li>
                    
                        <li>
                            <a href="/tealsql/Interval.html" class="{is_active}">
                                <span class="icon"><i class="fa fa-file"></i></span>
                                Interval                            </a>
                            <ul>
                                
                                    <li>
                                        <a href="/tealsql/Interval.html#months">
                                            <span class="icon is-small"><i class="fa fa-link"></i></span>
                                            months                                        </a>
                                    </li>
                                
                                    <li>
                                        <a href="/tealsql/Interval.html#days">
                                            <span class="icon is-small"><i class="fa fa-link"></i></span>
                                            days                                        </a>
                                    </li>
                                
                                    <li>
                                        <a href="/tealsql/Interval.html#microseconds">
                                            <span class="icon is-small"><i class="fa fa-link"></i></span>
                                            microseconds                                        </a>
                                    </li>
                                
                            </ul>
                        </li>
                    
                </ul>
            </aside>
            <div class="container column is-10">
                <div class="section">
                    <div class="panel">
                        <div class="panel-heading">
                            <h1 class="title">
                                Connection                                
                                        <label style="float:right" for="type-uses" class="button">Uses</label>
                                
                            </h1>
                        </div>
                        <div class="panel-block">
                            <div class="container max-width">
                                
    <div class="panel max-width">
        <input type="checkbox" id="type-uses" class="is-hidden hideable-state"/>
        <div class="panel-block is-hidden hideable-content">

            <h3 class="is-size-5">As Parameter:<h3>
            <ul>
 
                        <li>
                            <a href="/tealsql/Base.html#connect">Base.connect</a>
                        </li>
 
                        <li>
                            <a href="/tealsql/Pool.html#get_connection">Pool.get_connection</a>
                        </li>
 
                        <li>
                            <a href="/tealsql/Connection.html#fetch_optional">Connection.fetch_optional</a>
                        </li>
 
                        <li>
                            <a href="/tealsql/Connection.html#fetch_all">Connection.fetch_all</a>
                        </li>
 
                        <li>
                            <a href="/tealsql/Connection.html#fetch_all_async">Connection.fetch_all_async</a>
                        </li>
 
                        <li>
                            <a href="/tealsql/Connection.html#execute">Connection.execute</a>
                        </li>
 
                        <li>
                            <a href="/tealsql/Connection.html#fetch_one">Connection.fetch_one</a>
                        </li>
 
                        <li>
                            <a href="/tealsql/Connection.html#insert">Connection.insert</a>
                        </li>
 
                        <li>
                            <a href="/tealsql/Connection.html#update">Connection.update</a>
                        </li>
 
                        <li>
                            <a href="/tealsql/Connection.html#delete">Connection.delete</a>
                        </li>
 
                        <li>
                            <a href="/tealsql/Connection.html#begin">Connection.begin</a>
                        </li>
 
                        <li>
                            <a href="/tealsql/Connection.html#begin">Connection.begin</a>
                        </li>

            </ul>

        </div>
    </div>

                                            <div class="panel max-width">
                                                <div class="panel-heading">
                                                    <p class="subtitle">Type doc:</p>
                                                </div>
                                                <div class="panel-block">
                                                    
    <div class="container">
        <p>A single database connection</p>

    </div>

                                                </div>
                                            </div>
                                
    <div class="panel max-width">
        <div class="panel-heading">
            <p class="subtitle">Fields:</p>
        </div>
        <div class="panel-block">
            <div class="container">

            </div>
        </div>
    </div>

    <div class="panel max-width">
        <div class="panel-heading">
            <p class="subtitle">Methods:</p>
        </div>
        <div class="panel-block">
            <div class="container">

            <div class="card block">
                <div id="fetch_optional" class="card-heading">
                    <code class="card-header-title">
                        <p>fetch_optional: function(
                <a href="/tealsql/Connection.html">Connection</a>
,(string),({integer:boolean | integer | number | {any : any }  | string})):({string:boolean | integer | number | {any : any }  | string}) </p>
                    </code>
                </div>
                
                        <div class="card-content content">
                            
    <div class="container">
        <p>Fetches 1 or 0 results from the database</p>
<h2 class="subtitle is-H2">Params:</h2>
<ul>
<li>
<p>query: The query string that needs to be executed</p>
</li>
<li>
<p>params: An array (table) containing the parameters that this function needs</p>
</li>
</ul>

    </div>

                        </div>
                
            </div>

            <div class="card block">
                <div id="fetch_all" class="card-heading">
                    <code class="card-header-title">
                        <p>fetch_all: function(
                <a href="/tealsql/Connection.html">Connection</a>
,(string),({integer:boolean | integer | number | {any : any }  | string})):({{string:boolean | integer | number | {any : any }  | string}}) </p>
                    </code>
                </div>
                
                        <div class="card-content content">
                            
    <div class="container">
        <p>Fetches all results into a table</p>
<h2 class="subtitle is-H2">Params:</h2>
<ul>
<li>
<p>query: The query string that needs to be executed</p>
</li>
<li>
<p>params: An array (table) containing the parameters that this function needs</p>
</li>
</ul>

    </div>

                        </div>
                
            </div>

            <div class="card block">
                <div id="fetch_all_async" class="card-heading">
                    <code class="card-header-title">
                        <p>fetch_all_async: function(
                <a href="/tealsql/Connection.html">Connection</a>
,(string),({integer:boolean | integer | number | {any : any }  | string}),(integer)):(
                <a href="/tealsql/Stream.html">Stream</a>
) </p>
                    </code>
                </div>
                
                        <div class="card-content content">
                            
    <div class="container">
        <p>Runs a thread in the background that fetches all results. Allowing you to consume the results in batches, or do other things while the query is being executed</p>
<h1 class="subtitle is-H1">Params:</h1>
<ul>
<li>
<p>query: The query string that needs to be executed</p>
</li>
<li>
<p>params: An array (table) containing the parameters that this function needs</p>
</li>
<li>
<p>chunk_count: How big the batches are that will be returned from the background thread to the main one. Higher batch count may improve performance</p>
</li>
</ul>

    </div>

                        </div>
                
            </div>

            <div class="card block">
                <div id="execute" class="card-heading">
                    <code class="card-header-title">
                        <p>execute: function(
                <a href="/tealsql/Connection.html">Connection</a>
,(string),({integer:boolean | integer | number | {any : any }  | string})):(integer) </p>
                    </code>
                </div>
                
                        <div class="card-content content">
                            
    <div class="container">
        <p>Fetches exactly 1 value from the database.</p>
<h2 class="subtitle is-H2">Params:</h2>
<ul>
<li>
<p>query: The query string that needs to be executed</p>
</li>
<li>
<p>params: An array (table) containing the parameters that this function needs</p>
</li>
</ul>

    </div>

                        </div>
                
            </div>

            <div class="card block">
                <div id="fetch_one" class="card-heading">
                    <code class="card-header-title">
                        <p>fetch_one: function(
                <a href="/tealsql/Connection.html">Connection</a>
,(string),({integer:boolean | integer | number | {any : any }  | string})):({string:boolean | integer | number | {any : any }  | string}) </p>
                    </code>
                </div>
                
                        <div class="card-content content">
                            
    <div class="container">
        <h2 class="subtitle is-H2">Params:</h2>
<ul>
<li>
<p>query: The query string that needs to be executed</p>
</li>
<li>
<p>params: An array (table) containing the parameters that this function needs</p>
</li>
</ul>

    </div>

                        </div>
                
            </div>

            <div class="card block">
                <div id="insert" class="card-heading">
                    <code class="card-header-title">
                        <p>insert: function(
                <a href="/tealsql/Connection.html">Connection</a>
,(string),({string:boolean | integer | number | {any : any }  | string}),(boolean)):(integer) </p>
                    </code>
                </div>
                
                        <div class="card-content content">
                            
    <div class="container">
        <p>A shorthand to run a basic insert command.</p>
<h1 class="subtitle is-H1">WARNING!:</h1>
<p>the table and column names are NOT escaped. SQL injection IS possible if user input is allowed for these values.</p>
<p>The values that get inserted ARE properly escaped. For these, SQL injection is NOT possible.</p>
<h2 class="subtitle is-H2">Parameters:</h2>
<ul>
<li>
<p>name: the table name that will be inserted into</p>
</li>
<li>
<p>values: A table where the keys are the column names and the values are the values that will be inserted</p>
</li>
<li>
<p>needs_to_get_quoted: If the table name should get quotes around it. Defaults to false, set to true if the name contains .'s</p>
</li>
</ul>

    </div>

                        </div>
                
            </div>

            <div class="card block">
                <div id="update" class="card-heading">
                    <code class="card-header-title">
                        <p>update: function(
                <a href="/tealsql/Connection.html">Connection</a>
,(string),({string:boolean | integer | number | {any : any }  | string}),({string:boolean | integer | number | {any : any }  | string}),(boolean)):(integer) </p>
                    </code>
                </div>
                
                        <div class="card-content content">
                            
    <div class="container">
        <p>A shorthand to run a basic update command.</p>
<p>WARNING!:</p>
<p>the table and column names are NOT escaped. SQL injection IS possible if user input is allowed for these.</p>
<p>The values that get inserted ARE properly escaped. For these, SQL injection is NOT possible.</p>
<p>Parameters:</p>
<ul>
<li>
<p>name: the table name that will be inserted into</p>
</li>
<li>
<p>old_values: A table used to construct the <code>where</code> part of the query. The keys are the column names and the values are the values that will be matched against</p>
</li>
<li>
<p>new_values: A table where the keys are the column names and the values are the values that this column will be updated to</p>
</li>
<li>
<p>needs_to_get_quoted: If the table name should get quotes around it. Defaults to false, set to true if the name contains .'s</p>
</li>
</ul>

    </div>

                        </div>
                
            </div>

            <div class="card block">
                <div id="delete" class="card-heading">
                    <code class="card-header-title">
                        <p>delete: function(
                <a href="/tealsql/Connection.html">Connection</a>
,(string),({string:boolean | integer | number | {any : any }  | string}),(boolean)):(integer) </p>
                    </code>
                </div>
                
                        <div class="card-content content">
                            
    <div class="container">
        <p>A shorthand to run a basic delete command.</p>
<p>WARNING!:</p>
<p>the table and column names are NOT escaped. SQL injection IS possible if user input is allowed for these values.</p>
<p>The values that get inserted ARE properly escaped. For these, SQL injection is NOT possible.</p>
<p>Parameters:</p>
<ul>
<li>
<p>name: the table name that will be inserted into</p>
</li>
<li>
<p>old_values: A table used to construct the <code>where</code> part of the query. The keys are the column names and the values are the values that will be matched against</p>
</li>
<li>
<p>needs_to_get_quoted: If the table name should get quotes around it. Defaults to false, set to true if the name contains .'s</p>
</li>
</ul>

    </div>

                        </div>
                
            </div>

            <div class="card block">
                <div id="begin" class="card-heading">
                    <code class="card-header-title">
                        <p>begin: function&lt;Res&gt;(
                <a href="/tealsql/Connection.html">Connection</a>
,function(
                <a href="/tealsql/Connection.html">Connection</a>
):((boolean),(Res))):((boolean),(Res)) </p>
                    </code>
                </div>
                
                        <div class="card-content content">
                            
    <div class="container">
        <p>Starts a new transaction.</p>
<h2 class="subtitle is-H2">Params:</h2>
<ul>
<li>func: The function that will be executed after the transaction has been made.</li>
</ul>
<p>This function can return 2 values, the first is a boolean that determines if the transaction should be committed or not.</p>
<p>The second can be of any type and will be returned as is</p>
<p>After this function is executed the transaction will either be committed or rolled back.</p>
<p>It will be rolled back if the callback threw an error, or returned false for the first return value</p>
<p>Otherwise, it will be committed</p>
<h2 class="subtitle is-H2">Examples:</h2>
<h3 class="subtitle is-H3">Committing</h3>
                                <div class="tabs">
                                    <ul>
                                        <li class="select-teal"><a>Teal</a></li>
                                        <li class="select-lua"><a>Lua</a></li>
                                    </ul>
                                </div>
                            <div class="code-block-teal">
<pre><code class="language-lua">local tealsql = require(&quot;pages/tealsql/definitions.tealsql&quot;)
tealsql.connect(&quot;postgres://userName:password@host/database&quot;,function(con:tealsql.Connection):{string:integer}
    local success, res = con:begin(function(con:tealsql.Connection):(boolean,integer)
        con:execute(&quot;INSERT INTO some_table (some_column) VALUES (1)&quot;);
        return true, 1
    end)
    assert(success)
    assert(res ==  1)
end)

</code></pre>
</div><div class="code-block-lua">
<pre><code class="language-lua">local tealsql = require(&quot;pages/tealsql/definitions.tealsql&quot;)
tealsql.connect(&quot;postgres://userName:password@host/database&quot;, function(con)
   local success, res = con:begin(function(con)
      con:execute(&quot;INSERT INTO some_table (some_column) VALUES (1)&quot;);
      return true, 1
   end)
   assert(success)
   assert(res == 1)
end)</code></pre>
</div>
<h3 class="subtitle is-H3">Manual Rollback</h3>
                                <div class="tabs">
                                    <ul>
                                        <li class="select-teal"><a>Teal</a></li>
                                        <li class="select-lua"><a>Lua</a></li>
                                    </ul>
                                </div>
                            <div class="code-block-teal">
<pre><code class="language-lua">local tealsql = require(&quot;pages/tealsql/definitions.tealsql&quot;)
tealsql.connect(&quot;postgres://userName:password@host/database&quot;,function(con:tealsql.Connection):{string:integer}
    local success, res = con:begin(function(con:tealsql.Connection):(boolean,integer)
        con:execute(&quot;INSERT INTO some_table (some_column) VALUES (1)&quot;);
        return false, 1
    end)
    assert(not success)
    assert(res ==  1)
end)
</code></pre>
</div><div class="code-block-lua">
<pre><code class="language-lua">local tealsql = require(&quot;pages/tealsql/definitions.tealsql&quot;)
tealsql.connect(&quot;postgres://userName:password@host/database&quot;, function(con)
   local success, res = con:begin(function(con)
      con:execute(&quot;INSERT INTO some_table (some_column) VALUES (1)&quot;);
      return false, 1
   end)
   assert(not success)
   assert(res == 1)
end)</code></pre>
</div>
<h3 class="subtitle is-H3">Rollback on error</h3>
                                <div class="tabs">
                                    <ul>
                                        <li class="select-teal"><a>Teal</a></li>
                                        <li class="select-lua"><a>Lua</a></li>
                                    </ul>
                                </div>
                            <div class="code-block-teal">
<pre><code class="language-lua">local tealsql = require(&quot;pages/tealsql/definitions.tealsql&quot;)
tealsql.connect(&quot;postgres://userName:password@host/database&quot;,function(con:tealsql.Connection):{string:integer}
    local success, res = con:begin(function(con:tealsql.Connection):(boolean,integer)
        con:execute(&quot;INSERT INTO some_table (some_column) VALUES (1)&quot;);
        error(&quot;This will also cause a rollback&quot;)
    end)
    --we will never reach this part, as the error gets rethrown
    assert(res ==  1)
end)


</code></pre>
</div><div class="code-block-lua">
<pre><code class="language-lua">local tealsql = require(&quot;pages/tealsql/definitions.tealsql&quot;)
tealsql.connect(&quot;postgres://userName:password@host/database&quot;, function(con)
   local success, res = con:begin(function(con)
      con:execute(&quot;INSERT INTO some_table (some_column) VALUES (1)&quot;);
      error(&quot;This will also cause a rollback&quot;)
   end)

   assert(res == 1)
end)</code></pre>
</div>
    </div>

                        </div>
                
            </div>

            <div class="card block">
                <div id="help" class="card-heading">
                    <code class="card-header-title">
                        <p>help: function(string):(string) </p>
                    </code>
                </div>
                
            </div>

            </div>
        </div>
    </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>
    <script>
        document.querySelectorAll(".hidden-themes-selector").forEach(x=>x.classList.remove("hidden-themes-selector"))
        const bulmaTheme = document.getElementById("bulma-theme")
        const isDarkTheme = {
            "Cerulean": false,
            "Cosmo": false,
            "Cyborg": true,
            "Darkly": true,
            "Default": false,
            "Flatly": false,
            "Journal": false,
            "Litera": false,
            "Lumen": false,
            "Lux": false,
            "Materia": false,
            "Minty": false,
            "Nuclear": true,
            "Pulse": false,
            "Sandstone": false,
            "Simplex": false,
            "Slate": true,
            "Solar": true,
            "Spacelab": false,
            "Superhero": true,
            "United": false,
            "Yeti": false
        }
        const lightHighlight = ` <link id="codeHighlight" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/styles/a11y-light.min.css"
        integrity="sha512-WDk6RzwygsN9KecRHAfm9HTN87LQjqdygDmkHSJxVkVI7ErCZ8ZWxP6T8RvBujY1n2/E4Ac+bn2ChXnp5rnnHA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />`
        const darkHighlight = `<link id="codeHighlight" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/styles/a11y-dark.min.css"
integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg=="
crossorigin="anonymous" referrerpolicy="no-referrer" />`
        const setTheme = (str, name) => {
            bulmaTheme.href = str;
            document.getElementById("codeHighlight").remove()
            const head = document.getElementById("head")
            if (isDarkTheme[name]) {
                head.insertAdjacentHTML("beforeend", darkHighlight)
            } else {
                head.insertAdjacentHTML("beforeend", lightHighlight)
            }
        }
        const v = localStorage.getItem("editor_last_selected");
        try {
            if (v) {
                const res = JSON.parse(v);
                if (res && res.name && res.url) {
                    setTheme(res.url, res.name)
                }
            }
        } catch (e) {
            console.error("Error while setting saved theme. Going back to default", e)
            localStorage.removeItem("editor_last_selected")
        }

        fetch("https://jenil.github.io/bulmaswatch/api/themes.json")
            .then(x => x.json())
            .then(x => {

                const max = x.themes.length / 2
                const col1 = document.querySelectorAll(".theme-select-column1")
                const col2 = document.querySelectorAll(".theme-select-column2")
                x.themes.forEach((z, k) => {
                    const a = document.createElement("a")
                    a.onclick = () => {
                        setTheme(z.css, z.name)
                        localStorage.setItem(
                            "editor_last_selected",
                            JSON.stringify({ url: z.css, name: z.name })
                        );
                    }
                    a.text = z.name;
                    const div = document.createElement("div")
                    div.classList.add("navbar-item")
                    div.appendChild(a)
                    if (k < max) {
                        col1.forEach(x=>x.appendChild(div.cloneNode(true)))
                    } else {
                        col2.forEach(x=>x.appendChild(div.cloneNode(true)))
                    }
                })
            })
        const getOpposite = (language) => language == "teal" ? "lua" : "teal"
        const preferredLanguage = localStorage.getItem("last_selected_language") || "teal";
        const disableLanguage = getOpposite(preferredLanguage)
        const elementsToDisable = document.getElementsByClassName("code-block-" + disableLanguage)
        for (var i = 0; i < elementsToDisable.length; i++) {
            elementsToDisable[i].style.display = "none"
        }

        const createSwitchLanguage = (newLang) =>
            () => {
                const oppositeLanguage = getOpposite(newLang)
                const toShow = document.getElementsByClassName("code-block-" + newLang)

                for (var i = 0; i < toShow.length; i++) {
                    toShow[i].style.display = ""; // or
                }
                const toHide = document.getElementsByClassName("code-block-" + oppositeLanguage)
                for (var i = 0; i < toHide.length; i++) {
                    toHide[i].style.display = "none";
                }
                const removeFromActive = document.getElementsByClassName("select-" + oppositeLanguage)
                for (var i = 0; i < removeFromActive.length; i++) {
                    removeFromActive[i].classList.remove("is-active")
                }
                const addToActive = document.getElementsByClassName("select-" + newLang)
                for (var i = 0; i < addToActive.length; i++) {
                    addToActive[i].classList.add("is-active")
                }
                localStorage.setItem("last_selected_language", newLang)

            }

        const elementsToSetActive = document.getElementsByClassName("select-" + preferredLanguage)
        for (var i = 0; i < elementsToSetActive.length; i++) {
            elementsToSetActive[i].classList.add("is-active")
            elementsToSetActive[i].onclick = createSwitchLanguage(preferredLanguage)
        }
        const otherLangSelectors = document.getElementsByClassName("select-" + disableLanguage)
        for (var i = 0; i < otherLangSelectors.length; i++) {
            otherLangSelectors[i].onclick = createSwitchLanguage(disableLanguage)
        }

    </script>
    <script>hljs.highlightAll();</script>
</body>

</html>